(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},2811:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>c,routeModule:()=>m,tree:()=>l});var n=r(7096),s=r(6132),a=r(7284),i=r.n(a),o=r(2564),u={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(u[e]=()=>o[e]);r.d(t,u);let l=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,3982)),"/Users/dansci/Documents/Projects/student-help-queue/teacher-frontend/app/page.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,5345)),"/Users/dansci/Documents/Projects/student-help-queue/teacher-frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/Users/dansci/Documents/Projects/student-help-queue/teacher-frontend/app/page.tsx"],d="/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new n.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},8672:(e,t,r)=>{Promise.resolve().then(r.bind(r,5755))},5755:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>Home});var n=r(784),s=r(9885);let a=(0,s.createContext)({});var i=r(3258);let o="https://student-help-queue-backend-dbc8c16c81bf.herokuapp.com/api/activeEntries",u=null,setToken=e=>{u=e?`Bearer ${e}`:null},getActiveEntries=async()=>{let e={};return u&&(e={headers:{Authorization:u}}),(await i.Z.get(`${o}`,e)).data},addName=async e=>{let t={};return u&&(t={headers:{Authorization:u}}),(await i.Z.post(`${o}`,{queueName:e},t)).data},resolveEntry=async(e,t)=>{let r={};u&&(r={headers:{Authorization:u}}),await i.Z.post(`${o}/${e._id}`,{resolutionStatus:t},r)},getActiveQueues=async()=>{let e={};return u&&(e={headers:{Authorization:u}}),(await i.Z.get("https://student-help-queue-backend-dbc8c16c81bf.herokuapp.com/api/queues/active",e)).data},attemptLogin=async e=>{let t=await i.Z.post("https://student-help-queue-backend-dbc8c16c81bf.herokuapp.com/api/login",{credential:e});return setToken(t.data.token),t.data},components_Header=e=>{let{handleLogout:t}=e,r=(0,s.useContext)(a);return(0,n.jsxs)("p",{children:["logged in as ",r.user.email,n.jsx("button",{onClick:t,children:"log out"})]})};var l=r(3248);let components_LoginButton=e=>{let{setSession:t}=e;return n.jsx(l.kZ,{onSuccess:e=>{if(!e.credential)throw Error("credential not returned");let r=e.credential;attemptLogin(r).then(e=>{t(e),window.localStorage.setItem("studentHelpQueueUser",JSON.stringify(e))})},onError:()=>{console.log("Login error")}})};var c=r(9817),d=r(1319);let p=(0,s.createContext)(0),m=c.ZP.div`
  display: flex;
  flex-direction: column;
  background-color: #8d94ba;
  padding: 10px;
  border-radius: 10px;
`,g=c.ZP.div`
  background-color: #a0cfd3;
  border-radius: 5px;
  padding: 10px;
  margin: 10px;
`,x=c.ZP.button`
  background-color: rgb(233, 246, 233);
  border: none;
  border-radius: 5px;
`,h=c.ZP.button`
  background-color: rgb(255, 241, 223);
  border: none;
  border-radius: 5px;
`;c.ZP.button`
  border-radius: 10px;
`;let f=c.ZP.h2`
  padding: 10px;
`,getEntryAge=(e,t,r)=>{let n=Math.floor((e-(t+r))/1e3/60);if(n<1)return"< 1m";if(n>60){let e=Math.floor(n/60);return`${e}h ${n-60*e}m`}return`${n}m`},components_Queue=e=>{let{queueName:t,entries:r}=e,[i,o]=(0,s.useState)(new Date().getTime()),u=(0,s.useContext)(a),l=(0,d.useQueryClient)(),c=(0,d.useMutation)({mutationFn:({queueName:e})=>addName(e),onSuccess:()=>{l.invalidateQueries(["entries"])}}),y=(0,d.useMutation)({mutationFn:({entry:e})=>resolveEntry(e,"resolve"),onSuccess:()=>{l.invalidateQueries({queryKey:["entries"]})}}),v=(0,d.useMutation)({mutationFn:({entry:e})=>resolveEntry(e,"cancel"),onSuccess:()=>{l.invalidateQueries({queryKey:["entries"]})}}),_=(0,s.useContext)(p);return(0,s.useEffect)(()=>{setInterval(()=>{o(new Date().getTime())},3e3)},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(f,{children:[t," queue"]}),r.find(e=>e.user.email===u.user.email)?"":n.jsx("button",{onClick:()=>c.mutate({queueName:t}),children:"add name"}),n.jsx(m,{children:r.map(e=>(0,n.jsxs)(g,{children:[e.user.givenName," ",e.user.familyName," (",getEntryAge(i,new Date(e.timestamp).getTime(),_),")",e._id&&(0,n.jsxs)(n.Fragment,{children:[n.jsx(x,{onClick:()=>{y.mutate({entry:e})},children:"Resolve"}),n.jsx(h,{onClick:async()=>{v.mutate({entry:e})},children:"Cancel"})]})]},e.user.email))})]})},components_QueueSet=e=>{let t=(0,s.useContext)(a);(0,d.useQueryClient)();let r=(0,d.useQuery)({queryKey:["queues"],queryFn:getActiveQueues,retry:2,refetchInterval:3e3}),i=(0,d.useQuery)({queryKey:["entries"],queryFn:async()=>await getActiveEntries(),retry:!r.isError,refetchInterval:3e3});if(i.isLoading||r.isLoading)return n.jsx(n.Fragment,{children:n.jsx("p",{children:" Loading data ... "})});if(r.error||!r.data)return n.jsx(n.Fragment,{children:(0,n.jsxs)("p",{children:["unable to get queues for class",`"${t.selectedClass.name}"`,"with teacher email ",t.selectedClass.teacherEmail]})});if(i.error)return n.jsx(n.Fragment,{children:(0,n.jsxs)("p",{children:["unable to get entries in queues: ",`${r.data}`]})});let o=0;return i.data&&(o=new Date().getTime()-new Date(i.data.timestamp).getTime()),n.jsx(p.Provider,{value:o,children:r.data.map(e=>n.jsx(components_Queue,{queueName:e,entries:i.data?.entries.filter(t=>t.queueName===e)||[]},e))})},isString=e=>"string"==typeof e||e instanceof String,isUser=e=>!!(e&&"object"==typeof e&&"email"in e&&isString(e.email)&&"givenName"in e&&isString(e.givenName)&&"familyName"in e&&isString(e.familyName)),isSession=e=>{if(!e||"object"!=typeof e||!("user"in e&&isUser(e.user))||!("selectedClass"in e&&e.selectedClass&&"object"==typeof e.selectedClass))return!1;let t=e.selectedClass;return!!("name"in t&&t.name&&isString(t.name)&&"teacherEmail"in t&&t.teacherEmail&&isString(t.teacherEmail)&&"token"in e&&e.token&&isString(e.token))},y=new d.QueryClient,app_App=()=>{let[e,t]=(0,s.useState)(null);(0,s.useEffect)(()=>{let e=window.localStorage.getItem("studentHelpQueueUser");if(e){let r=JSON.parse(e);isSession(r)?(t(r),setToken(r.token)):handleLogout()}},[]);let handleLogout=()=>{window.localStorage.removeItem("studentHelpQueueUser"),t(null),setToken(null)};return e?n.jsx(d.QueryClientProvider,{client:y,children:(0,n.jsxs)(a.Provider,{value:e,children:[n.jsx(components_Header,{handleLogout:handleLogout}),n.jsx(components_QueueSet,{})]})}):n.jsx(components_LoginButton,{setSession:t})},v=new d.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});function Home(){return n.jsx(l.rg,{clientId:"615824003785-78c7s0ehtahn0jc20jd2ebpgiumvq1dk.apps.googleusercontent.com",children:n.jsx(d.QueryClientProvider,{client:v,children:n.jsx(app_App,{})})})}},3982:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>u});var n=r(5153);let s=(0,n.createProxy)(String.raw`/Users/dansci/Documents/Projects/student-help-queue/teacher-frontend/app/page.tsx`),{__esModule:a,$$typeof:i}=s,o=s.default,u=o},7481:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var n=r(8531);let __WEBPACK_DEFAULT_EXPORT__=e=>{let t=(0,n.fillMetadataSegment)(".",e.params,"favicon.ico");return[{type:"image/x-icon",sizes:"16x16",url:t+""}]}}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[472,221,188],()=>__webpack_exec__(2811));module.exports=r})();