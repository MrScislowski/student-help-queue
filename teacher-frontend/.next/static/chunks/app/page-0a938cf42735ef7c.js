(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1460:function(e,t,n){Promise.resolve().then(n.bind(n,5117))},5117:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var r=n(7437),a=n(2265);let i=(0,a.createContext)({});var o=n(9222);let s="https://student-help-queue-backend-dbc8c16c81bf.herokuapp.com/api/activeEntries",u=null,setToken=e=>{u=e?"Bearer ".concat(e):null},getActiveEntries=async()=>{let e={};return u&&(e={headers:{Authorization:u}}),(await o.Z.get("".concat(s),e)).data},addName=async e=>{let t={};return u&&(t={headers:{Authorization:u}}),(await o.Z.post("".concat(s),{queueName:e},t)).data},resolveEntry=async(e,t)=>{let n={};u&&(n={headers:{Authorization:u}}),await o.Z.post("".concat(s,"/").concat(e._id),{resolutionStatus:t},n)},getActiveQueues=async()=>{let e={};return u&&(e={headers:{Authorization:u}}),(await o.Z.get("".concat("https://student-help-queue-backend-dbc8c16c81bf.herokuapp.com/api/queues/active"),e)).data},attemptLogin=async e=>{let t=await o.Z.post("".concat("https://student-help-queue-backend-dbc8c16c81bf.herokuapp.com/api/login"),{credential:e});return setToken(t.data.token),t.data};var components_Header=e=>{let{handleLogout:t}=e,n=(0,a.useContext)(i);return(0,r.jsxs)("p",{children:["logged in as ",n.user.email,(0,r.jsx)("button",{onClick:t,children:"log out"})]})},c=n(220),components_LoginButton=e=>{let{setSession:t}=e;return(0,r.jsx)(c.kZ,{onSuccess:e=>{if(!e.credential)throw Error("credential not returned");let n=e.credential;attemptLogin(n).then(e=>{t(e),window.localStorage.setItem("studentHelpQueueUser",JSON.stringify(e))})},onError:()=>{console.log("Login error")}})},l=n(230),d=n(802),m=n(9077);let p=(0,a.createContext)(0);function _templateObject(){let e=(0,l._)(["\n  display: flex;\n  flex-direction: column;\n  background-color: #8d94ba;\n  padding: 10px;\n  border-radius: 10px;\n"]);return _templateObject=function(){return e},e}function _templateObject1(){let e=(0,l._)(["\n  background-color: #a0cfd3;\n  border-radius: 5px;\n  padding: 10px;\n  margin: 10px;\n"]);return _templateObject1=function(){return e},e}function _templateObject2(){let e=(0,l._)(["\n  background-color: rgb(233, 246, 233);\n  border: none;\n  border-radius: 5px;\n"]);return _templateObject2=function(){return e},e}function _templateObject3(){let e=(0,l._)(["\n  background-color: rgb(255, 241, 223);\n  border: none;\n  border-radius: 5px;\n"]);return _templateObject3=function(){return e},e}function _templateObject4(){let e=(0,l._)(["\n  border-radius: 10px;\n"]);return _templateObject4=function(){return e},e}function _templateObject5(){let e=(0,l._)(["\n  padding: 10px;\n"]);return _templateObject5=function(){return e},e}let g=d.ZP.div(_templateObject()),h=d.ZP.div(_templateObject1()),f=d.ZP.button(_templateObject2()),b=d.ZP.button(_templateObject3());d.ZP.button(_templateObject4());let j=d.ZP.h2(_templateObject5()),getEntryAge=(e,t,n)=>{let r=Math.floor((e-(t+n))/1e3/60);if(r<1)return"< 1m";if(r>60){let e=Math.floor(r/60);return"".concat(e,"h ").concat(r-60*e,"m")}return"".concat(r,"m")};var components_Queue=e=>{let{queueName:t,entries:n}=e,[o,s]=(0,a.useState)(new Date().getTime()),u=(0,a.useContext)(i),c=(0,m.useQueryClient)(),l=(0,m.useMutation)({mutationFn:e=>{let{queueName:t}=e;return addName(t)},onSuccess:()=>{c.invalidateQueries(["entries"])}}),d=(0,m.useMutation)({mutationFn:e=>{let{entry:t}=e;return resolveEntry(t,"resolve")},onSuccess:()=>{c.invalidateQueries({queryKey:["entries"]})}}),x=(0,m.useMutation)({mutationFn:e=>{let{entry:t}=e;return resolveEntry(t,"cancel")},onSuccess:()=>{c.invalidateQueries({queryKey:["entries"]})}}),y=(0,a.useContext)(p);return(0,a.useEffect)(()=>{setInterval(()=>{s(new Date().getTime())},3e3)},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(j,{children:[t," queue"]}),n.find(e=>e.user.email===u.user.email)?"":(0,r.jsx)("button",{onClick:()=>l.mutate({queueName:t}),children:"add name"}),(0,r.jsx)(g,{children:n.map(e=>(0,r.jsxs)(h,{children:[e.user.givenName," ",e.user.familyName," (",getEntryAge(o,new Date(e.timestamp).getTime(),y),")",e._id&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f,{onClick:()=>{d.mutate({entry:e})},children:"Resolve"}),(0,r.jsx)(b,{onClick:async()=>{x.mutate({entry:e})},children:"Cancel"})]})]},e.user.email))})]})},components_QueueSet=e=>{let t=(0,a.useContext)(i);(0,m.useQueryClient)();let n=(0,m.useQuery)({queryKey:["queues"],queryFn:getActiveQueues,retry:2,refetchInterval:3e3}),o=(0,m.useQuery)({queryKey:["entries"],queryFn:async()=>await getActiveEntries(),retry:!n.isError,refetchInterval:3e3});if(o.isLoading||n.isLoading)return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("p",{children:" Loading data ... "})});if(n.error||!n.data)return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("p",{children:["unable to get queues for class",'"'.concat(t.selectedClass.name,'"'),"with teacher email ",t.selectedClass.teacherEmail]})});if(o.error)return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("p",{children:["unable to get entries in queues: ","".concat(n.data)]})});let s=0;return o.data&&(s=new Date().getTime()-new Date(o.data.timestamp).getTime()),(0,r.jsx)(p.Provider,{value:s,children:n.data.map(e=>{var t;return(0,r.jsx)(components_Queue,{queueName:e,entries:(null===(t=o.data)||void 0===t?void 0:t.entries.filter(t=>t.queueName===e))||[]},e)})})};let isString=e=>"string"==typeof e||e instanceof String,isUser=e=>!!(e&&"object"==typeof e&&"email"in e&&isString(e.email)&&"givenName"in e&&isString(e.givenName)&&"familyName"in e&&isString(e.familyName)),isSession=e=>{if(!e||"object"!=typeof e||!("user"in e&&isUser(e.user))||!("selectedClass"in e&&e.selectedClass&&"object"==typeof e.selectedClass))return!1;let t=e.selectedClass;return!!("name"in t&&t.name&&isString(t.name)&&"teacherEmail"in t&&t.teacherEmail&&isString(t.teacherEmail)&&"token"in e&&e.token&&isString(e.token))},x=new m.QueryClient;var app_App=()=>{let[e,t]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=window.localStorage.getItem("studentHelpQueueUser");if(e){let n=JSON.parse(e);isSession(n)?(t(n),setToken(n.token)):handleLogout()}},[]);let handleLogout=()=>{window.localStorage.removeItem("studentHelpQueueUser"),t(null),setToken(null)};return e?(0,r.jsx)(m.QueryClientProvider,{client:x,children:(0,r.jsxs)(i.Provider,{value:e,children:[(0,r.jsx)(components_Header,{handleLogout:handleLogout}),(0,r.jsx)(components_QueueSet,{})]})}):(0,r.jsx)(components_LoginButton,{setSession:t})};let y=new m.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1}}});function Home(){return(0,r.jsx)(c.rg,{clientId:"615824003785-78c7s0ehtahn0jc20jd2ebpgiumvq1dk.apps.googleusercontent.com",children:(0,r.jsx)(m.QueryClientProvider,{client:y,children:(0,r.jsx)(app_App,{})})})}}},function(e){e.O(0,[671,971,472,744],function(){return e(e.s=1460)}),_N_E=e.O()}]);